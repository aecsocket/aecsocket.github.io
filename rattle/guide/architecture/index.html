<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-rattle/guide/architecture">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.4.0">
<title data-rh="true">Architecture | aecsocket.github.io</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://aecsocket.github.io/rattle/guide/architecture"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Architecture | aecsocket.github.io"><meta data-rh="true" name="description" content="An explanation of the concepts and design of the project."><meta data-rh="true" property="og:description" content="An explanation of the concepts and design of the project."><link data-rh="true" rel="icon" href="/img/icon.svg"><link data-rh="true" rel="canonical" href="https://aecsocket.github.io/rattle/guide/architecture"><link data-rh="true" rel="alternate" href="https://aecsocket.github.io/rattle/guide/architecture" hreflang="en"><link data-rh="true" rel="alternate" href="https://aecsocket.github.io/rattle/guide/architecture" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.4593d7b7.css">
<link rel="preload" href="/assets/js/runtime~main.e1a1c873.js" as="script">
<link rel="preload" href="/assets/js/main.42db7040.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}return t}()||function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/icon.svg" alt="aecsocket" class="themedImage_ToTc themedImage--light_HNdA"><img src="/img/icon.svg" alt="aecsocket" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">aecsocket.github.io</b></a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/aecsocket/aecsocket.github.io" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebarViewport_Xe31"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/">Overview</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/klam/">Klam</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/glossa/">Glossa</a><button aria-label="Toggle the collapsible sidebar category &#x27;Glossa&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/alexandria/">Alexandria</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" href="/rattle/">Rattle</a><button aria-label="Toggle the collapsible sidebar category &#x27;Rattle&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/rattle/platforms/">Platforms</a><button aria-label="Toggle the collapsible sidebar category &#x27;Platforms&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" tabindex="0" href="/rattle/guide/">Guide</a><button aria-label="Toggle the collapsible sidebar category &#x27;Guide&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/rattle/guide/architecture">Architecture</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/rattle/guide/user/">User guide</a><button aria-label="Toggle the collapsible sidebar category &#x27;User guide&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/rattle/guide/dev/">Developer guide</a></li></ul></li></ul></li></ul></nav></div></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/rattle/"><span itemprop="name">Rattle</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/rattle/guide/"><span itemprop="name">Guide</span></a><meta itemprop="position" content="2"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Architecture</span><meta itemprop="position" content="3"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><h1>Architecture</h1><p>An explanation of the concepts and design of the project.</p><p>Here is a brief overview of the terminology and concepts used in the project - if you need more
detailed explanations on the various concepts, see the code documentation.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="physics-engine">Physics engine<a href="#physics-engine" class="hash-link" aria-label="Direct link to Physics engine" title="Direct link to Physics engine">​</a></h2><p>Rattle is simply a frontend, or wrapper, around an existing physics engine - this engine is called
the &quot;backend&quot;. The current backend and technologies used are:</p><ul><li><code>rattle-api</code> - the frontend exposed to developers for communicating with a physics engine</li><li><a href="https://rapier.rs" target="_blank" rel="noopener noreferrer">Rapier</a> - a physics engine written in Rust</li><li><a href="https://github.com/aecsocket/rapier-ffi/tree/main/rapier-ffi" target="_blank" rel="noopener noreferrer">rapier-ffi/rapier-ffi</a> - C bindings for the Rust engine</li><li><a href="https://github.com/aecsocket/rapier-ffi/tree/main/rapier-java" target="_blank" rel="noopener noreferrer">rapier-ffi/rapier-java</a> - Java bindings for the C bindings</li><li><code>rattle-rapier</code> - the implementation of <code>rattle-api</code> for the Rapier engine</li><li>The platform implementations of Rattle, e.g. <code>rattle-paper</code></li></ul><p>Since the backend is not written in Java, it is referred to as a &quot;native library&quot; - as in, it is
managed by the native operating system, not the JVM (Java).</p><p>The engine&#x27;s job is to create and manage resources that are required by the native libraries, such
as physics spaces and rigid bodies.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="geometry">Geometry<a href="#geometry" class="hash-link" aria-label="Direct link to Geometry" title="Direct link to Geometry">​</a></h2><p>A geometry is a raw, user-created version of a shape with volume in the world. Some examples of
geometries are spheres or boxes. Geometries do not store any info on where they are in the world;
they only store local data. By itself, a geometry cannot be used for physics simulations, however
can be baked into a <em>shape</em>.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="shape">Shape<a href="#shape" class="hash-link" aria-label="Direct link to Shape" title="Direct link to Shape">​</a></h2><p>A shape is a baked (converted) form of a <em>geometry</em> which can be used for physics. You can <strong>not</strong>
get a geometry back from a shape. These also do not store info on where they are in the world,
and may be somewhat expensive to compute (e.g. if doing a more complex operation like making a
convex hull or convex decomposition). So it is best to cache these and reuse them as much as
possible.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="physics-space">Physics space<a href="#physics-space" class="hash-link" aria-label="Direct link to Physics space" title="Direct link to Physics space">​</a></h2><p>All physics simulation happens inside of a physics space. There can be multiple physics spaces
active at once, but they cannot share any physics state like <em>rigid bodies</em> (data is OK though,
like <em>shapes</em>).</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="collider">Collider<a href="#collider" class="hash-link" aria-label="Direct link to Collider" title="Direct link to Collider">​</a></h2><p>A collider is an object owned by a physics space which has a <em>shape</em> and position in the world,
and allows other colliders to be affected by it - this means it can push them away via forces
and impulses, the typical classical mechanics effects. However, a collider cannot move by itself -
it has no concept of a velocity (linear or angular). Instead, this is done by <em>rigid bodies</em>.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="rigid-body">Rigid body<a href="#rigid-body" class="hash-link" aria-label="Direct link to Rigid body" title="Direct link to Rigid body">​</a></h2><p>A rigid body is an object that simulates Newtonian dynamics such as velocity, forces, and impulses.
Although a collider may apply forces to other objects, a rigid body is the object that actually
uses those forces to be pushed away, spun, etc. Zero or more colliders may be attached to a rigid
body, in which case the collider effectively follows the body as it moves.
Rigid bodies may be:</p><ul><li>fixed - the body does not move by itself</li><li>dynamic - the physics engine simulates forces and dynamics for themselves</li><li>kinematic - the user defines what position the body moves to, and the engine calculates the
velocities for that</li></ul><p>A rigid body may also have continuous collision detection enabled (CCD) to make collision detection
more precise when the body is moving quickly (due to tunneling). At a glance, this does a
continuous sweep to test for collisions between a body&#x27;s old and current position, and if so,
moves it back to that first hit.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="joint">Joint<a href="#joint" class="hash-link" aria-label="Direct link to Joint" title="Direct link to Joint">​</a></h2><p>A joint is a constraint that can be applied by a user to a physics space, which ensures that two
rigid bodies keep some sort of positional relationship to each other - it ensures that the
constraint is &quot;solved&quot;. For example, a door may be modelled by a joint which locks the translation
of a body (not allowing it to move), but keeps a single &quot;hinge&quot; axis free for rotation
(allowing it to swing, but only on one axis). Limits could further be applied to these axis to
allow it to only swing a certain amount.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="impulse-joints">Impulse joints<a href="#impulse-joints" class="hash-link" aria-label="Direct link to Impulse joints" title="Direct link to Impulse joints">​</a></h3><p>An impulse joint applies impulses to try to solve its constraint. This means that they
are fast to compute, and they are flexible, allowing loops in the graph of all joints in the space.
However, they do not resolve constraints perfectly - there is often error in the position.
This is fine for most applications, but not all.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="multibody-joints">Multibody joints<a href="#multibody-joints" class="hash-link" aria-label="Direct link to Multibody joints" title="Direct link to Multibody joints">​</a></h3><p>A multibody joint works in reduced coordinates, forming a tree of multibodies in the physics space
which resolve their positions all at once. This means that they work slower, however are
guaranteed to perfectly resolve constraints (as long as the constraints themselves are valid).</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="world-physics">World physics<a href="#world-physics" class="hash-link" aria-label="Direct link to World physics" title="Direct link to World physics">​</a></h2><p>When working with a server environment, each world loaded in the game will have up to one
physics space assigned to it. This handles all physics for this world, and can be manipulated
using commands and through the API.</p><p>Developer note: this is one of the most crucial parts of the API, however there are some safety
guarantees you must uphold when working with one! See the corresponding classes in the code for more documentation.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="terrain-strategy">Terrain strategy<a href="#terrain-strategy" class="hash-link" aria-label="Direct link to Terrain strategy" title="Direct link to Terrain strategy">​</a></h3><p>To allow blocks in the world to be collidable, we use a terrain strategy. The current terrain
strategy is a &quot;dynamic terrain&quot; implementation, which creates collision on-the-fly as bodies
enter or exit chunks in the world.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="entity-strategy">Entity strategy<a href="#entity-strategy" class="hash-link" aria-label="Direct link to Entity strategy" title="Direct link to Entity strategy">​</a></h3><p>To allow entities in the world to be collidable, we use an entity strategy. The default
implementation simply assigns a rigid body to entities, and moves the body around as the entity
also moves.</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/aecsocket/aecsocket.github.io/blob/main/docs/rattle/guide/architecture.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_vwxv"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/rattle/guide/"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Guide</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/rattle/guide/user/"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">User guide</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#physics-engine" class="table-of-contents__link toc-highlight">Physics engine</a></li><li><a href="#geometry" class="table-of-contents__link toc-highlight">Geometry</a></li><li><a href="#shape" class="table-of-contents__link toc-highlight">Shape</a></li><li><a href="#physics-space" class="table-of-contents__link toc-highlight">Physics space</a></li><li><a href="#collider" class="table-of-contents__link toc-highlight">Collider</a></li><li><a href="#rigid-body" class="table-of-contents__link toc-highlight">Rigid body</a></li><li><a href="#joint" class="table-of-contents__link toc-highlight">Joint</a><ul><li><a href="#impulse-joints" class="table-of-contents__link toc-highlight">Impulse joints</a></li><li><a href="#multibody-joints" class="table-of-contents__link toc-highlight">Multibody joints</a></li></ul></li><li><a href="#world-physics" class="table-of-contents__link toc-highlight">World physics</a><ul><li><a href="#terrain-strategy" class="table-of-contents__link toc-highlight">Terrain strategy</a></li><li><a href="#entity-strategy" class="table-of-contents__link toc-highlight">Entity strategy</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2023 aecsocket. Built with Docusaurus.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.e1a1c873.js"></script>
<script src="/assets/js/main.42db7040.js"></script>
</body>
</html>